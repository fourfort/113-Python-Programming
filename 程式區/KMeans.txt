import pandas as pd
from sklearn.cluster import KMeans
import numpy as np

# 讀取CSV文件
file_path = '/content/drive/MyDrive/大樂透/大樂透歷史記錄 .csv' # 確保檔案路徑正確
afile = pd.read_csv(file_path)
file_path2 = '/content/drive/MyDrive/大樂透/guojing0805.csv'  # 新的 CSV 文件路徑

# 提取中獎號碼
draws = []
for i in range(len(afile)):
    numbers = [afile.iloc[i]['num1'], afile.iloc[i]['num2'], afile.iloc[i]['num3'],
               afile.iloc[i]['num4'], afile.iloc[i]['num5'], afile.iloc[i]['num6']]
    draws.append(numbers)

# 計算每個號碼的出現次數
all_numbers = [num for draw in draws for num in draw]
number_frequency = pd.Series(all_numbers).value_counts().sort_index()

# 轉換成DataFrame
df = pd.DataFrame({"Number": number_frequency.index, "Frequency": number_frequency.values})

# 使用K-means聚類算法將號碼分為兩組
kmeans = KMeans(n_clusters=2, n_init=10, random_state=42)  # 修改默認參數
kmeans.fit(df[['Frequency']])
df['Cluster'] = kmeans.labels_

# 分別選擇兩組號碼中的一組作為預測
cluster_0_numbers = df[df['Cluster'] == 0]['Number'].tolist()
cluster_1_numbers = df[df['Cluster'] == 1]['Number'].tolist()

# 隨機選擇一組號碼作為預測
prediction_numbers = np.random.choice(cluster_0_numbers + cluster_1_numbers, size=6, replace=False)

# 分析特別號碼
special_numbers = afile['特別號'].tolist()
special_frequency = pd.Series(special_numbers).value_counts().sort_index()
df_special = pd.DataFrame({"Special Number": special_frequency.index, "Frequency": special_frequency.values})

# 使用K-means聚類算法將特別號碼分為兩組
kmeans_special = KMeans(n_clusters=2, n_init=10, random_state=42)  # 修改默認參數
kmeans_special.fit(df_special[['Frequency']])
df_special['Cluster'] = kmeans_special.labels_

# 分別選擇兩組特別號中的一組作為預測
cluster_0_special = df_special[df_special['Cluster'] == 0]['Special Number'].tolist()
cluster_1_special = df_special[df_special['Cluster'] == 1]['Special Number'].tolist()

# 隨機選擇一組特別號作為預測
prediction_special = np.random.choice(cluster_0_special + cluster_1_special, size=1, replace=False)

# 建立預測結果的 DataFrame
predicted_df = pd.DataFrame({
    "Method": ["KMeans"],  # 預測方法
    "Num1": [prediction_numbers[0]],  # 預測的號碼1
    "Num2": [prediction_numbers[1]],  # 預測的號碼2
    "Num3": [prediction_numbers[2]],  # 預測的號碼3
    "Num4": [prediction_numbers[3]],  # 預測的號碼4
    "Num5": [prediction_numbers[4]],  # 預測的號碼5
    "Num6": [prediction_numbers[5]],  # 預測的號碼6
    "Special": [prediction_special[0]],  # 預測的特別號
})
# 列印預測結果表格
print("\n預測結果：")
print(predicted_df.to_string(index=False))

# 將預測結果寫入新的CSV文件
predicted_df.to_csv(file_path2, index=False)


